<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Facebooker::Service</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Facebooker::Service</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/vendor/plugins/facebooker/lib/facebooker/service_rb.html">
                vendor/plugins/facebooker/lib/facebooker/service.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000384">active_service</a>&nbsp;&nbsp;
      <a href="#M000376">active_service</a>&nbsp;&nbsp;
      <a href="#M000377">active_service=</a>&nbsp;&nbsp;
      <a href="#M000375">new</a>&nbsp;&nbsp;
      <a href="#M000381">post</a>&nbsp;&nbsp;
      <a href="#M000385">post_file</a>&nbsp;&nbsp;
      <a href="#M000382">post_form</a>&nbsp;&nbsp;
      <a href="#M000383">post_multipart_form</a>&nbsp;&nbsp;
      <a href="#M000380">process_async</a>&nbsp;&nbsp;
      <a href="#M000379">with_async</a>&nbsp;&nbsp;
      <a href="#M000378">with_service</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000376" class="method-detail">
        <a name="M000376"></a>

        <div class="method-heading">
          <a href="#M000376" class="method-signature">
          <span class="method-name">active_service</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000376-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000376-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 10</span>
10:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active_service</span>
11:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@active_service</span>
12:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Facebooker</span>.<span class="ruby-identifier">use_curl?</span>
13:           <span class="ruby-ivar">@active_service</span> = <span class="ruby-constant">Facebooker</span><span class="ruby-operator">::</span><span class="ruby-constant">Service</span><span class="ruby-operator">::</span><span class="ruby-constant">CurlService</span>.<span class="ruby-identifier">new</span>
14:         <span class="ruby-keyword kw">else</span>
15:           <span class="ruby-ivar">@active_service</span> = <span class="ruby-constant">Facebooker</span><span class="ruby-operator">::</span><span class="ruby-constant">Service</span><span class="ruby-operator">::</span><span class="ruby-constant">NetHttpService</span>.<span class="ruby-identifier">new</span>
16:         <span class="ruby-keyword kw">end</span>        
17:       <span class="ruby-keyword kw">end</span>
18:       <span class="ruby-ivar">@active_service</span>
19:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000377" class="method-detail">
        <a name="M000377"></a>

        <div class="method-heading">
          <a href="#M000377" class="method-signature">
          <span class="method-name">active_service=</span><span class="method-args">(new_service)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000377-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000377-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 21</span>
21:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active_service=</span>(<span class="ruby-identifier">new_service</span>)
22:       <span class="ruby-ivar">@active_service</span> = <span class="ruby-identifier">new_service</span>
23:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000375" class="method-detail">
        <a name="M000375"></a>

        <div class="method-heading">
          <a href="#M000375" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(api_base, api_path, api_key)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000375-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000375-source">
<pre>
   <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 4</span>
4:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">api_base</span>, <span class="ruby-identifier">api_path</span>, <span class="ruby-identifier">api_key</span>)
5:       <span class="ruby-ivar">@api_base</span> = <span class="ruby-identifier">api_base</span>
6:       <span class="ruby-ivar">@api_path</span> = <span class="ruby-identifier">api_path</span>
7:       <span class="ruby-ivar">@api_key</span> = <span class="ruby-identifier">api_key</span>
8:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000380" class="method-detail">
        <a name="M000380"></a>

        <div class="method-heading">
          <a href="#M000380" class="method-signature">
          <span class="method-name">process_async</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000380-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000380-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 57</span>
57:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">process_async</span>
58:       <span class="ruby-identifier">active_service</span>.<span class="ruby-identifier">process</span>
59:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000379" class="method-detail">
        <a name="M000379"></a>

        <div class="method-heading">
          <a href="#M000379" class="method-signature">
          <span class="method-name">with_async</span><span class="method-args">(&amp;proc)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Process all calls to Facebook in th block asynchronously nil will be
returned from all calls and no results will be parsed. This is mostly
useful for sending large numbers of notifications or sending a lot of
profile updates
</p>
<p>
for example:
</p>
<pre>
  User.find_in_batches(:batch_size =&gt; 200) do |users|
    Faceboooker::Service.with_async do
      users.each {|u| u.facebook_session.send_notification(...)}
    end
  end
</pre>
<p>
Note: You shouldn&#8216;t make more than about 200 api calls in a <a
href="Service.html#M000379">with_async</a> block or you might exhaust all
filehandles.
</p>
<p>
This functionality require the typhoeus gem
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000379-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000379-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 52</span>
52:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">with_async</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">proc</span>)
53:       <span class="ruby-identifier">block_with_process</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">proc</span>.<span class="ruby-identifier">call</span> ; <span class="ruby-identifier">process_async</span>}
54:       <span class="ruby-identifier">with_service</span>(<span class="ruby-constant">Facebooker</span><span class="ruby-operator">::</span><span class="ruby-constant">Service</span><span class="ruby-operator">::</span><span class="ruby-constant">TyphoeusMultiService</span>.<span class="ruby-identifier">new</span>,<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block_with_process</span>)
55:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000378" class="method-detail">
        <a name="M000378"></a>

        <div class="method-heading">
          <a href="#M000378" class="method-signature">
          <span class="method-name">with_service</span><span class="method-args">(service) {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000378-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000378-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 25</span>
25:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">with_service</span>(<span class="ruby-identifier">service</span>)
26:       <span class="ruby-identifier">old_service</span> = <span class="ruby-identifier">active_service</span>
27:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active_service</span> = <span class="ruby-identifier">service</span>
28:       <span class="ruby-keyword kw">begin</span>
29:         <span class="ruby-keyword kw">yield</span>
30:       <span class="ruby-keyword kw">ensure</span>
31:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">active_service</span> = <span class="ruby-identifier">old_service</span>
32:       <span class="ruby-keyword kw">end</span>
33:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000384" class="method-detail">
        <a name="M000384"></a>

        <div class="method-heading">
          <a href="#M000384" class="method-signature">
          <span class="method-name">active_service</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000384-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000384-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 85</span>
85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">active_service</span>
86:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">active_service</span>
87:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000381" class="method-detail">
        <a name="M000381"></a>

        <div class="method-heading">
          <a href="#M000381" class="method-signature">
          <span class="method-name">post</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
TODO: support ssl
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000381-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000381-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 63</span>
63:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post</span>(<span class="ruby-identifier">params</span>)
64:       <span class="ruby-identifier">attempt</span> = <span class="ruby-value">0</span>
65:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">active_service</span>.<span class="ruby-identifier">parse_results?</span>
66:         <span class="ruby-constant">Parser</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:method</span>], <span class="ruby-identifier">post_form</span>(<span class="ruby-identifier">url</span>,<span class="ruby-identifier">params</span>) )
67:       <span class="ruby-keyword kw">else</span>
68:         <span class="ruby-identifier">post_form</span>(<span class="ruby-identifier">url</span>,<span class="ruby-identifier">params</span>)
69:       <span class="ruby-keyword kw">end</span>
70:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECONNRESET</span>, <span class="ruby-constant">EOFError</span>
71:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attempt</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
72:         <span class="ruby-identifier">attempt</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
73:         <span class="ruby-keyword kw">retry</span>
74:       <span class="ruby-keyword kw">end</span>
75:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000385" class="method-detail">
        <a name="M000385"></a>

        <div class="method-heading">
          <a href="#M000385" class="method-signature">
          <span class="method-name">post_file</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000385-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000385-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 89</span>
89:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_file</span>(<span class="ruby-identifier">params</span>)
90:       <span class="ruby-identifier">service_url</span> = <span class="ruby-identifier">url</span>(<span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:base</span>))
91:       <span class="ruby-identifier">result</span> = <span class="ruby-identifier">post_multipart_form</span>(<span class="ruby-identifier">service_url</span>, <span class="ruby-identifier">params</span>)
92:       <span class="ruby-constant">Parser</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:method</span>], <span class="ruby-identifier">result</span>)
93:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000382" class="method-detail">
        <a name="M000382"></a>

        <div class="method-heading">
          <a href="#M000382" class="method-signature">
          <span class="method-name">post_form</span><span class="method-args">(url,params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000382-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000382-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 77</span>
77:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_form</span>(<span class="ruby-identifier">url</span>,<span class="ruby-identifier">params</span>)
78:       <span class="ruby-identifier">active_service</span>.<span class="ruby-identifier">post_form</span>(<span class="ruby-identifier">url</span>,<span class="ruby-identifier">params</span>)
79:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000383" class="method-detail">
        <a name="M000383"></a>

        <div class="method-heading">
          <a href="#M000383" class="method-signature">
          <span class="method-name">post_multipart_form</span><span class="method-args">(url,params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000383-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000383-source">
<pre>
    <span class="ruby-comment cmt"># File vendor/plugins/facebooker/lib/facebooker/service.rb, line 81</span>
81:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">post_multipart_form</span>(<span class="ruby-identifier">url</span>,<span class="ruby-identifier">params</span>)
82:       <span class="ruby-identifier">active_service</span>.<span class="ruby-identifier">post_multipart_form</span>(<span class="ruby-identifier">url</span>,<span class="ruby-identifier">params</span>)
83:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>