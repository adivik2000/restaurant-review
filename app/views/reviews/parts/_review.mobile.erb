<%
   tag_name = tag_name || 'div'
   grid_class = grid_class || 'grid_6'
   hide_comment = hide_comment || false
%>
<<%= tag_name %> valign='top'>
  <%= link_to image_tag(review.user.display_picture,
                        :width => '40px', :alt => 'DP'),
              user_long_url(:id => review.user.id,
                            :login => review.user.login),
              :class => 'image_small' %>
</<%= tag_name %>>
<<%= tag_name %> class="review <%= grid_class %> hreview" valign='top'>
  <a name="review-<%= review.id %>"></a>
  <% if !review.comment.blank? %>
    <span class="content"><%= simple_format h(review.comment) %> - </span>
  <% end %>

  <span class="reviewer">
    <%= link_to review.user.login, user_long_url(
        :id => review.user.id, :login => review.user.login) %>
    <% if review.loved? %>
      <%= tt('loved') %>
    <% elsif review.hated? %>
      <%= tt('hated') %>
    <% elsif review.wanna_go? %>
      <%= tt('wanna go to') %>
    <% end %>
    <%= tt('this place!') %>
  </span>
  <span class="date" title="<%= review.updated_at.strftime('%d %b %Y') %>">
    updated <%= distance_of_time_in_words(review.updated_at, Time.now) %> ago.
    <% if logged_in? %>
      [<a class="date add_comment_link" href='javascript: void(0)'
          rel='<%= review.id %>'
          id="add_comment_link_<%= review.id %>">add your comment!</a>]
    <% end %>
    <% if hide_comment && review.review_comments.count > 0 %>
      <a href='javascript:void(0)'>show comments</a>
    <% end %>
  </span>
  <div class="clear"></div>
  <div class="space_10"></div>

  <%= render :partial => 'review_comments/parts/review_comment_form', :locals => {:review => review} %>

  <% comments = review.review_comments %>
  <% if !comments.empty? %>
    <table class='review_comments' style="display:<%= hide_comment ? 'none' : 'block' %>">
      <tbody>
        <% comments.each do |comment| %>
          <tr>
            <td>
              <%= link_to "#{image_tag(comment.user.display_picture,
                                       :width => '40px', :alt => 'N/A')} <br/> #{comment.user.login}",
                          user_long_url(:login => comment.user.login,
                                        :id => comment.user.id) %>
            </td>
            <td class='review_comment'>
              <em><%= h(comment.content) %></em>
              <span class="date" title="<%= comment.updated_at.strftime('%d %b %Y') %>">
                -
                <%= distance_of_time_in_words(comment.updated_at, Time.now) %>
                ago.
                <% if comment.loved? %>
                  [<span class='icon_loved'><%= tt('liked') %></span>]
                <% else %>
                  [<span class='icon_hated'><%= tt('disliked') %></span>]
                <% end %>

                <% if comment.author?(current_user) && comment.can_delete? %>
                  [<%= link_to('delete', review_comment_url(:id => comment.id),
                               :method => 'DELETE',
                               :confirm => 'Do you really want to remove this comment?',
                               :title => 'FYI, You can remove this comment with in 10 minutes of its submission time.') %>
                  ]
                <% end %>
              </span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
</<%= tag_name %>>

<script type="text/javascript">
  $('.add_comment_link').each(function() {
    var $self = $(this);
    $self.bind('click', function() {
      $('#review_comment_form_' + $self.attr('rel')).show();
    });
  });

  $('.review_comment_form').each(function() {
    $(this).hide();
  });
</script>