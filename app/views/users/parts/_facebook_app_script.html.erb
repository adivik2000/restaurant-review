<%= fb_connect_javascript_tag %>

<script type="text/javascript">
  App.Facebook = {
    UID: null,
    SID: null,
    API: null,
    SESSION: null
  }

  App.Facebook.Events = {
    onloggedin: function(pUid) {
      if (pUid) {
        var api = App.Facebook.API = FB.Facebook.apiClient;
        var session = App.Facebook.SESSION = api.get_session();
        var uid = App.Facebook.UID = pUid;

        if ($('#info_before').length > 0) {
          $('#info_before, #facebook_connect_button').hide();
          $('#info_after, #facebook_profile_box').show();
          $.get('<%= facebook_connect_update_url %>', {'uid': uid, 'sid': session.session_key});
        }

        FB.Connect.showPermissionDialog('publish_stream');
      }
    },

    onloggedout: function() {
      if ($('#info_before').length > 0) {
        $('#info_before, #facebook_connect_button').show();
        $('#info_after, #facebook_profile_box').hide();
        $.get('<%= facebook_connect_update_url %>', {'uid': '', 'sid': ''});
      }
    }
  }
</script>

<%= init_fb_connect(:app_settings => "{
    'ifUserConnected': App.Facebook.Events.onloggedin,
    'ifUserNotConnected': App.Facebook.Events.onloggedout}") %>